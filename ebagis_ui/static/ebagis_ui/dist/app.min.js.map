{"version":3,"sources":["app/app.ts","templates.ts"],"names":["app","angular","module","directive","$rootScope","UserProfile","linkFn","scope","element","attrs","authenticated","user","data","$on","$apply","console","log","restrict","templateUrl","link","config","$stateProvider","$urlRouterProvider","$locationProvider","auth","anon","Auth","isAnonymous","isAuthenticated","admin","hasRole","html5Mode","otherwise","state","url","controller","resolve","userProfile","factory","OK","UNAUTHORIZED","FORBIDDEN","NOTFOUND","role","Promise","reject","hasAnyRole","roles","force","then","err","UserProfileClass","api","rootScope","this","authPromise","initialize","prototype","authenticationStatus","setAuthenticated","val","$broadcast","getAuthenticated","refresh","up","profile","response","clearUserToken","indexOf","filter","length","promise","login","username","password","logout","service","run","$state","event","toState","toParams","fromState","fromParams","error","go","$scope","ebagisAPI","Validate","model","first_name","last_name","email","complete","updateProfile","formData","errors","form_validation","$invalid","awesomeThings","http","cookies","$http","$cookies","API_URL","window","appConfig","restURL","use_session","request","args","trace","get","defaults","headers","common","Authorization","params","method","withCredentials","toUpperCase","X-CSRFToken","success","bind","status","remove","register","firstName","lastName","password1","password2","more","activation_url","href","replace","extend","key","put","changePassword","new_password1","new_password2","resetPassword","reset_url","site_name","verify","confirmReset","uid","token","sessions","non_field_errors","$location","prompt","handleSuccess","handleError","goVerify","path","goConfirmReset","show_login","$timeout","processForm","message","$stateParams","minlength","maxlength","required","more_messages","demo","check_more_messages","name","validation_messages","field","form","error_bin","messages","e","$error","special_message","push","deduped_messages","forEach","el","i","substr","failure","$templateCache"],"mappings":"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","file":"app.min.js","sourcesContent":["/// <reference path=\"../../../typings/main.d.ts\" />\n\nvar app = angular.module('ebagis', [\n    'app.templates',\n    'ui.bootstrap',\n    'ngCookies',\n    'ngResource',\n    'ngSanitize',\n    'ui.router',\n]);\n\napp.directive('header', ['$rootScope', 'UserProfile', function($rootScope, UserProfile){\n   var linkFn = function(scope, element, attrs) {       \n        scope.authenticated = false;\n        scope.user = UserProfile.data;\n        \n        $rootScope.$on('UserProfile.authenticated', function() {\n            scope.$apply(function() {\n                scope.authenticated = true;\n                scope.user = UserProfile.data;\n                console.log(\"user after login: \", scope.user);\n            });\n        });\n\n        $rootScope.$on('UserProfile.unauthenticated', function() {\n            scope.$apply(function() {\n                scope.authenticated = false;\n                scope.user = UserProfile.data;\n                console.log(\"user after logout: \", scope.user);\n            });\n        });\n    };\n\n    return {\n        restrict: 'E',\n        templateUrl: 'app-templates/app/partial/header/header.html',\n        link: linkFn,\n    };\n}]);\n\napp.directive('headerAccount', function(){\n    return {\n        restrict: 'E',\n        templateUrl: 'app-templates/app/partial/header/account.html',\n    };\n});\n\napp.config([\"$stateProvider\", '$urlRouterProvider', '$locationProvider', function ($stateProvider, $urlRouterProvider, $locationProvider) {\n\n    // standard auth types\n    var auth = {\n        anon: [\"Auth\", function (Auth) { return Auth.isAnonymous(true); }],\n        auth: [\"Auth\", function (Auth) { return Auth.isAuthenticated(true); }],\n        admin: [\"Auth\", function (Auth) { return Auth.hasRole(\"ROLE_ADMIN\"); }],\n    }\n\n    // remove the # from urls where supported\n    $locationProvider.html5Mode(true);\n\n    // set the default route -> redirect requests to unrecognized pages\n    // might consider making a 404 page and redirecting to that\n    $urlRouterProvider.otherwise('404');\n\n    // setup the states (routes) on the stateProvider\n    $stateProvider\n\n    // anyone states\n    .state(\"forbidden\", {\n            /* ... */\n     })\n\n    .state(\"404\", {\n        url: '/404',\n        templateUrl: 'app-templates/app/partial/main/404.html',\n     })\n    \n    // anonymous states\n    .state(\"login\", {\n        url: '/account/login',\n        templateUrl: 'app-templates/app/partial/account/login.html',\n        controller: 'LoginController',\n        resolve: {\n            auth: auth.anon,\n            userProfile: \"UserProfile\",\n        }\n    })\n\n    .state(\"register\", {\n        url: '/account/register',\n        templateUrl: 'app-templates/app/partial/account/register.html',\n        controller: 'RegisterController',\n        resolve: {\n            auth: auth.anon,\n            userProfile: \"UserProfile\",\n        }\n    })\n\n    .state(\"forgot\", {\n        url: '/account/reset',\n        templateUrl: 'app-templates/app/partial/account/passwordreset.html',\n        controller: 'PasswordResetController',\n        resolve: {\n            auth: auth.anon,\n            userProfile: \"UserProfile\",\n        }\n    })\n\n    .state(\"resetConfirm\", {\n        url: '/account/resetConfirm/{userToken:[0-9A-Za-z_\\-]+}/{passwordResetToken:[0-9A-Za-z]{1,13}-[0-9A-Za-z]{1,20}}',\n        //url: '/account/resetConfirm/:userToken/:passwordResetToken',\n        templateUrl: 'app-templates/app/partial/account/passwordresetconfirm.html',\n        controller: 'PasswordResetConfirmController',\n        resolve: {\n            auth: auth.anon,\n            userProfile: \"UserProfile\",\n        }\n    })\n\n    .state(\"verifyEmail\", {\n        url: '/account/verifyEmail/{emailVerificationToken:[^/]{1,65}}',\n        templateUrl: 'app-templates/app/partial/account/verifyemail.html',\n        controller: 'VerifyEmailController',\n        resolve: {\n            auth: auth.anon,\n            userProfile: \"UserProfile\",\n        }\n    })\n\n\n    // authenticated states\n    .state(\"logout\", {\n        url: '/account/logout',\n        templateUrl: 'app-templates/app/partial/account/logout.html',\n        controller: 'LogoutController',\n        resolve: {\n            auth: auth.auth,\n            userProfile: \"UserProfile\",\n        }\n    })\n\n    .state(\"account\", {\n        url: '/account',\n        templateUrl: 'app-templates/app/partial/account/account.html',\n        resolve: {\n            auth: auth.auth,\n            userProfile: \"UserProfile\",\n        }\n    })\n\n    .state(\"changePassword\", {\n        url: '/account/changepassword',\n        templateUrl: 'app-templates/app/partial/account/passwordchange.html',\n        controller: 'PasswordChangeController',\n        resolve: {\n            auth: auth.auth,\n            userProfile: \"UserProfile\",\n        }\n    })\n\n    .state(\"root\", {\n        url: '/',\n        controller: 'RootController',\n        resolve: {\n            auth: auth.auth,\n            userProfile: \"UserProfile\",\n        }\n    })\n\n    .state(\"home\", {\n        url: '/map',\n        templateUrl: 'app-templates/app/partial/map/map.html',\n        controller: 'MapController',\n        resolve: {\n            auth: auth.auth,\n            userProfile: \"UserProfile\",\n        }\n    })\n\n    // staff-only states\n\n    // admin-only states\n    .state(\"admin\", {\n        /* ... */\n        resolve: {\n            auth: auth.admin,\n        }\n    });\n\n}])\n\napp.factory(\"Auth\", [\"UserProfile\", function (UserProfile) {\n\n    var Auth = {\n\n        OK: 200,\n\n        // \"we don't know who you are, so we can't say if you're authorized to access\n        // this resource or not yet, please sign in first\"\n        UNAUTHORIZED: 401,\n\n        // \"we know who you are, and your profile does not allow you to access this resource\"\n        FORBIDDEN: 403,\n\n        NOTFOUND: 404,\n\n        hasRole: function(role) {\n            return new Promise(function(resolve, reject) {\n                if (UserProfile.hasRole(role)) {\n                    resolve(Auth.OK);\n                } else if (UserProfile.isAnonymous()) {\n                    reject(Auth.UNAUTHORIZED);\n                } else {\n                    reject(Auth.FORBIDDEN);\n                }\n            });\n        },\n\n        hasAnyRole: function(roles) {\n            return new Promise(function(resolve, reject) {\n                if (UserProfile.hasAnyRole(roles)) {\n                    resolve(Auth.OK);\n                } else if (UserProfile.isAnonymous()) {\n                    reject(Auth.UNAUTHORIZED);\n                } else {\n                    reject(Auth.FORBIDDEN);\n                }\n            });\n        },\n\n        isAnonymous: function(force) {\n            return new Promise(function(resolve, reject) {\n                UserProfile.isAnonymous(force).then(\n                    function() {\n                        resolve(Auth.OK);\n                    }).catch(function(err) {\n                        reject(Auth.FORBIDDEN);\n                    }\n                );\n            });\n        },\n\n        isAuthenticated: function(force) {\n            return new Promise(function(resolve, reject) {\n                UserProfile.isAuthenticated(force).then(\n                    function() {\n                        resolve(Auth.OK);\n                    }).catch(function(err) {\n                        reject(Auth.UNAUTHORIZED);\n                    }\n                );\n            });\n        },\n\n    };\n\n    return Auth;\n\n}])\n\nclass UserProfileClass {\n\n    constructor(api, rootScope) {\n        // use rootScope for signals to watchers\n        this.$rootScope = rootScope;\n\n        // need to store whether or not the current user is authenticated\n        this.authenticated = null,\n\n        // we use authPromise to store the last auth request made\n        // in case we've just made the request and it hasn't returned yet\n        // thus, we can be efficient and not request again unless forced\n        this.authPromise = null,\n        \n        // the service with the API methods\n        this.api = api;\n\n        // finally let's run some initialization logic\n        this.initialize();\n    }\n\n    initialize() {\n        // setup our API service\n        // first arg is the base URL of the server API\n        // second arg is a boolean of whether to use django sessions or not\n        //this.api.initialize(window.appConfig.urlBase + '/api/rest/account', false);\n        // run authenticationStatus the first time to determine initial\n        // value for this.authenticated\n        this.authenticationStatus(true).then(function() {\n            console.log(\"user is logged in on profile initialization\");\n        }).catch(function(err) {\n            console.log(\"profile error on initialization: \", err);\n        });\n    }\n\n    setAuthenticated(val) {\n        if (this.authenticated != val) {\n            this.authenticated = val;\n            if (val) {\n                this.$rootScope.$broadcast(\"UserProfile.authenticated\");\n            } else {\n                this.$rootScope.$broadcast(\"UserProfile.unauthenticated\");\n            }\n        }\n    }\n\n    getAuthenticated() {\n        return this.authenticated;\n    }\n\n    refresh() {\n        up = this\n        up.authPromise = new Promise(function(resolve, reject) {\n        //return new Promise(function(resolve, reject) {\n            up.api.profile().then(function(response) {\n                up.data = response;\n                up.setAuthenticated(true);\n                resolve(response);\n            }).catch(function(err) {\n                up.setAuthenticated(false);\n                // destroy any cached login tokens\n                up.api.clearUserToken();\n                reject(err);\n            });\n        });\n        return up.authPromise;\n    }\n\n    hasRole(role) {\n        return this.data.roles.indexOf(role) >= 0;\n    }\n\n    hasAnyRole(roles) {\n        return !!this.data.roles.filter(function (role) {\n            return roles.indexOf(role) >= 0;\n        }).length;\n    }\n\n    isAnonymous(force) {\n        up = this\n        return new Promise(function(resolve, reject) {\n            up.authenticationStatus(force).then(\n                function() {\n                    reject();\n                }).catch(function(err) {\n                    resolve(err);\n                }\n            );\n        });\n    }\n\n    isAuthenticated(force) {\n        up = this\n        return new Promise(function(resolve, reject) {\n            up.authenticationStatus(force).then(\n                function() {\n                    resolve();\n                }).catch(function(err) {\n                    reject(err);\n                }\n            );\n        });\n    }\n\n    authenticationStatus(force) {\n        // Set force to true to ignore stored value and query API\n        force = force || false;\n        var up = this;\n        return new Promise(function(resolve, reject) {\n            if (up.authPromise != null && !force) {\n                // we have a stored promise\n                promise = up.authPromise;\n            } else {\n                // we don't have a strored promise, or we're forcing a\n                // request back to the API to verify the authentication status\n                promise = up.refresh();\n            }\n            promise.then(function() {\n                resolve();\n            }).catch(function(err) {\n                reject(\"User is not logged in.\", err);\n            });\n        });\n    }\n\n    login(username, password) {\n        up = this;\n        return up.api.login(username, password).then(function() {\n            return up.authenticationStatus(true).then(function() {\n                up.$rootScope.$broadcast(\"UserProfile.logged_in\", data);\n            }).catch(function(err) {\n                console.log(err);\n            });\n        }).catch(function(err) {\n            console.log(err);\n            return err;\n        });\n    }\n\n    logout() {\n        up = this;\n        return up.api.logout().then(function(){\n            up.data = null;\n            up.authPromise = null;\n            up.setAuthenticated(false);\n            up.$rootScope.$broadcast(\"UserProfile.logged_out\");\n        }).catch(function(err) {\n            console.log(err);\n        });\n    }\n}\n\napp.service(\"UserProfile\", [\"ebagisAPI\", \"$rootScope\", UserProfileClass]);\n\napp.run([\"$rootScope\", \"Auth\", \"$state\", \"UserProfile\", function ($rootScope, Auth, $state, UserProfile) {\n    // if a user trys to go to a page they can't access, redirect them\n    $rootScope.$on(\"$stateChangeError\", function (event, toState, toParams, fromState, fromParams, error) {\n        console.log(\"caught an auth error: request to \", toState,\" with params \", toParams, \" returned \", error);\n        if (error == Auth.UNAUTHORIZED) {\n            console.log(\"unauthed: go to login\");\n            $state.go(\"login\");\n        } else if (error == Auth.FORBIDDEN) {\n            console.log(\"forbidden: go home\");\n            $state.go(\"root\");\n        } else if (error == Auth.NOTFOUND) {\n            console.log(\"not found: go 404\");\n            $state.go(\"404\");\n        }\n    });\n}])\n\napp.controller('RootController', ['$scope', '$state', function ($scope, $state) {\n    $state.go(\"account\");\n}]);\n\napp.controller('UserProfileController', ['$scope', 'ebagisAPI', 'Validate', 'UserProfile', function ($scope, ebagisAPI, Validate, UserProfile) {\n    $scope.model = {'first_name':'','last_name':'','email':''};\n    $scope.complete = false;\n   \n    $scope.model = UserProfile.data;\n\n    $scope.updateProfile = function(formData, model){\n        $scope.errors = [];\n        Validate.form_validation(formData,$scope.errors);\n        if (!formData.$invalid) {\n        ebagisAPI.updateProfile(model)\n            .then(function(data) {\n                // success case\n                $scope.complete = true;\n            }, function(data) {\n                // error case\n                $scope.error = data;\n            });\n        }\n    }\n}]);\n\napp.controller('AuthrequiredCtrl', function ($scope) {\n    $scope.awesomeThings = [\n      'HTML5 Boilerplate',\n      'AngularJS',\n      'Karma'\n    ];\n  });\n\n\nclass ebagisAPI {\n    \n    constructor(http, cookies, state) {\n        this.$http = http;\n        this.$cookies = cookies;\n        this.$state = state;\n\n        // Change this to point to your Django REST Auth API\n        // e.g. /api/rest-auth  (DO NOT INCLUDE ENDING SLASH)\n        this.API_URL = window.appConfig.restURL + '/account';\n        // Set use_session to true to use Django sessions to store security token.\n        // Set use_session to false to store the security token locally and transmit it as a custom header.\n        this.use_session = false;\n    }\n\n    request(args) {    \n        // uncomment next line for request tracing\n        console.trace();\n\n        // Let's retrieve the token from the cookie, if available\n        if (this.$cookies.get('token')) {\n            this.$http.defaults.headers.common.Authorization = 'Token ' + this.$cookies.get('token');\n        }\n        \n        // Continue\n        params = args.params || {}\n        args = args || {};\n        url = this.API_URL + args.url,\n        method = args.method || \"GET\",\n        params = params,\n        data = args.data || {};\n        api = this;\n\n        return new Promise(function(resolve, reject) {\n            // Fire the request, as configured.\n            api.$http({\n                url: url,\n                withCredentials: api.use_session,\n                method: method.toUpperCase(),\n                headers: {'X-CSRFToken': api.$cookies['csrftoken']},\n                params: params,\n                data: data\n            })\n\n            .success(angular.bind(api, function(data, status, headers, config) {\n                resolve(data, status);\n            }))\n\n            .error(angular.bind(api, function(data, status, headers, config) {\n                console.log(\"error syncing with: \" + url);\n                \n                // Set request status\n                if (data) {\n                    data.status = status;\n                }\n                \n                if (status == 0) {\n                    if (data == \"\") {\n                        data = {};\n                        data['status'] = 0;\n                        data['non_field_errors'] = [\"Could not connect. Please try again.\"];\n                    }\n                    // or if the data is null, then there was a timeout.\n                    if (data == null) {\n                        // Inject a non field error alerting the user\n                        // that there's been a timeout error.\n                        data = {};\n                        data['status'] = 0;\n                        data['non_field_errors'] = [\"Server timed out. Please try again.\"];\n                    }\n                }\n\n                reject(data, status, headers, config);\n            }));\n        });\n    }\n\n    clearUserToken() {\n        var api = this;\n        api.$cookies.remove('token');\n    }\n\n    register(firstName, lastName, username, password1, password2, email, more) {\n        var data = {\n            'first_name': firstName,\n            'last_name': lastName,\n            'username': username,\n            'password1': password1,\n            'password2': password2,\n            'email': email,\n            'activation_url': this.$state.href('verifyEmail').replace(/\\/+/g, \"/\"),\n        }\n        data = angular.extend(data, more);\n        return this.request({\n            'method': \"POST\",\n            'url': \"/registration/\",\n            'data' :data\n        });\n    }\n\n    login(username, password) {\n        var api = this;\n        delete api.$http.defaults.headers.common.Authorization;\n        api.$cookies.remove('token');\n\n        return api.request({\n            'method': \"POST\",\n            'url': \"/login/\",\n            'data':{\n                'username':username,\n                'password':password\n            }\n        }).then(function(data) {\n            if (!api.use_session) {\n                api.$http.defaults.headers.common.Authorization = 'Token ' + data.key;\n                api.$cookies.put(\"token\", data.key);\n            }\n            return data;\n        }, function(data) {\n            return data;\n        });\n    }\n\n    logout() {\n        var api = this;\n        return api.request({\n            'method': \"POST\",\n            'url': \"/logout/\",\n        }).then(function(data) {\n            delete api.$http.defaults.headers.common.Authorization;\n            api.clearUserToken();\n        });\n    }\n    \n    changePassword(password1, password2) {\n        return this.request({\n            'method': \"POST\",\n            'url': \"/password/change/\",\n            'data': {\n                'new_password1': password1,\n                'new_password2': password2\n            }\n        });\n    }\n    \n    resetPassword(email) {\n        return this.request({\n            'method': \"POST\",\n            'url': \"/password/reset/\",\n            'data': {\n                'email': email,\n                'reset_url': this.$state.href('resetConfirm').replace(/\\/+/g, \"/\"),\n                'site_name': 'ebagis',\n            }\n        });\n    }\n    \n    profile() {\n        return this.request({\n            'method': \"GET\",\n            'url': \"/user/\",\n        }); \n    }\n    \n    updateProfile(data) {\n        return this.request({\n            'method': \"PATCH\",\n            'url': \"/user/\",\n            'data': data\n        }); \n    }\n    \n    verify(key) {\n        return this.request({\n            'method': \"POST\",\n            'url': \"/registration/verify-email/\",\n            'data': {'key': key} \n        });            \n    }\n    \n    confirmReset(uid, token, password1, password2) {\n        return this.request({\n            'method': \"POST\",\n            'url': \"/password/reset/confirm/\",\n            'data': {\n                'uid': uid,\n                'token': token,\n                'new_password1':password1,\n                'new_password2':password2\n            }\n        });\n    }\n    \n    initialize(url, sessions) {\n        this.API_URL = url;\n        this.use_session = sessions;\n    }\n\n}\n\napp.service('ebagisAPI', ['$http', '$cookies', '$state', ebagisAPI]);\n\napp.controller('LoginController', ['$scope', '$state', 'Validate', 'UserProfile', function ($scope, $state, Validate, UserProfile) {\n    $scope.model = {\n        'username': '',\n        'password': '',\n    };\n    $scope.complete = false;\n\n    $scope.login = function(formData) {\n        $scope.errors = [];\n        Validate.form_validation(formData,$scope.errors);\n        \n        if (!formData.$invalid) {\n            UserProfile.login($scope.model.username, $scope.model.password)\n            .then(function() {  \n                if (UserProfile.getAuthenticated()) {\n                    $state.go('account');\n                } else {\n                    $scope.$apply(function() {\n                        $scope.errors = {'non_field_errors':['The provided username and/or password is incorrect.']}; \n                    });\n                }\n            });\n        }\n    }\n}]);\n\napp.controller('LogoutController', ['$scope', '$state', 'UserProfile', function ($scope, $state, UserProfile) {\n    UserProfile.logout().then(function(){\n        $state.go('login');\n    }).catch(function(err) {\n        console.log(err);\n    });\n}]);\n\napp.controller('MainController', ['$scope', '$cookies', '$location', 'ebagisAPI', 'UserProfile', function ($scope, $cookies, $location, ebagisAPI, UserProfile) {\n    \n    $scope.login = function(){\n      UserProfile.login(prompt('Username'),prompt('password'))\n      .then(function(data){\n        handleSuccess(data);\n      },handleError);\n    }\n    \n    $scope.logout = function(){\n      UserProfile.logout()\n      .then(handleSuccess,handleError);\n    }\n    \n    $scope.resetPassword = function(){\n      ebagisAPI.resetPassword(prompt('Email'))\n      .then(handleSuccess,handleError);\n    }\n    \n    $scope.register = function(){\n      ebagisAPI.register(\n          prompt('First Name'),\n          prompt('Last Name'),\n          prompt('Username'),\n          prompt('Password'),\n          prompt('Email')\n      )\n      .then(handleSuccess,handleError);\n    }\n    \n    $scope.verify = function(){\n      ebagisAPI.verify(prompt(\"Please enter verification code\"))\n      .then(handleSuccess,handleError);\n    }\n    \n    $scope.goVerify = function(){\n      $location.path(\"/verifyEmail/\"+prompt(\"Please enter verification code\"));\n    }\n    \n    $scope.changePassword = function(){\n      ebagisAPI.changePassword(prompt(\"Password\"), prompt(\"Repeat Password\"))\n      .then(handleSuccess,handleError);\n    }\n    \n    $scope.profile = function(){\n      ebagisAPI.profile()\n      .then(handleSuccess,handleError);\n    }\n    \n    $scope.updateProfile = function(){\n      ebagisAPI.updateProfile({'first_name': prompt(\"First Name\"), 'last_name': prompt(\"Last Name\"), 'email': prompt(\"Email\")})\n      .then(handleSuccess,handleError);\n    }\n    \n    $scope.confirmReset = function(){\n      ebagisAPI.confirmReset(prompt(\"Code 1\"), prompt(\"Code 2\"), prompt(\"Password\"), prompt(\"Repeat Password\"))\n      .then(handleSuccess,handleError);\n    }\n\n    $scope.goConfirmReset = function(){\n      $location.path(\"/passwordResetConfirm/\"+prompt(\"Code 1\")+\"/\"+prompt(\"Code 2\"))\n    }\n    \n    var handleSuccess = function(data){\n      $scope.response = data;\n    }\n    \n    var handleError = function(data){\n      $scope.response = data;\n    }\n\n    $scope.show_login = true;\n    $scope.$on(\"UserProfile.logged_in\", function(data){\n      $scope.show_login = false;\n    });\n    $scope.$on(\"UserProfile.logged_out\", function(data){\n      $scope.show_login = true;\n    });\n\n}]);\n\napp.controller('PasswordChangeController', function ($scope, $state, $timeout, ebagisAPI, Validate) {\n    $scope.model = {'new_password1':'','new_password2':''};\n    $scope.complete = false;\n    $scope.changePassword = function(formData){\n        $scope.errors = [];\n        Validate.form_validation(formData,$scope.errors);\n        if(!formData.$invalid){\n            ebagisAPI.changePassword($scope.model.new_password1, $scope.model.new_password2)\n            .then(function(data){\n                // success case\n                console.log(data);\n                $scope.$apply(function() {\n                    $scope.complete = true;\n                });\n                $timeout(function(){$state.go(\"login\");}, 8000);\n            }, function(data){\n                // error case\n                console.log(data);\n                $scope.$apply(function () {\n                    $scope.errors = data;\n                });\n            });\n        }\n    }\n});\n\napp.controller('PasswordResetController', function ($scope, $state, $timeout, ebagisAPI, Validate) {\n    $scope.processForm = function(email) {\n        $scope.errors = [];\n        Validate.form_validation(email, $scope.errors);\n        if (!$scope.email.$invalid) {\n            console.log($scope.email);\n            ebagisAPI.resetPassword($scope.email)\n            .then(function(data) {\n                // success case\n                console.log(data);\n                $scope.$apply(function() {\n                    $scope.message = data.success;\n                });\n                $timeout(function(){$state.go(\"login\");}, 8000);\n            }, function(data) {\n                // error case\n                console.log(data);\n                $scope.$apply(function () {\n                    $scope.errors = data;\n                });\n            });\n        }\n    };\n});\n\napp.controller('PasswordResetConfirmController', function ($scope, $stateParams, $state, $timeout, ebagisAPI, Validate) {\n    $scope.model = {'new_password1':'','new_password2':''};\n    $scope.complete = false;\n    $scope.confirmReset = function(formData) {\n        $scope.errors = [];\n        Validate.form_validation(formData,$scope.errors);\n        if(!formData.$invalid) {\n            ebagisAPI.confirmReset(\n                    $stateParams['userToken'],\n                    $stateParams['passwordResetToken'],\n                    $scope.model.new_password1,\n                    $scope.model.new_password2,\n            ).then(function(data) {\n                // success case\n                $scope.$apply(function() {\n                    $scope.complete = true;\n                });\n                $timeout(function(){$state.go(\"login\");}, 8000);\n            }, function(data) {\n                // error case\n                $scope.$apply(function() {\n                    $scope.errors = data;\n                });\n            });\n        }\n    }\n});\n\napp.controller('RestrictedController', function ($scope, $location) {\n    $scope.$on('UserProfile.logged_in', function() {\n        $location.path('/');\n    });\n});\n\napp.controller('RegisterController', function ($scope, ebagisAPI, Validate) {\n    $scope.model = {\n        'firstName': '',\n        'lastName': '',\n        'username': '',\n        'password': '',\n        'email': ''\n    };\n    $scope.complete = false;\n    $scope.register = function(formData) {\n        $scope.errors = [];\n        Validate.form_validation(formData,$scope.errors);\n        if (!formData.$invalid) {\n            ebagisAPI.register(\n                $scope.model.firstName,\n                $scope.model.lastName,\n                $scope.model.username,\n                $scope.model.password1,\n                $scope.model.password2,\n                $scope.model.email\n            ).then(function(data) {\n                // success case\n                $scope.$apply(function() {\n                    $scope.complete = true;\n                });\n            }, function(data) {\n                // error case\n                $scope.$apply(function() {\n                    $scope.errors = data;\n                });\n            });\n        }\n    }\n});\n\napp.service('Validate', function Validate() {\n    return {\n        'message': {\n            'minlength': 'This value is not long enough.',\n            'maxlength': 'This value is too long.',\n            'email': 'A properly formatted email address is required.',\n            'required': 'This field is required.'\n        },\n        'more_messages': {\n            'demo': {\n                'required': 'Here is a sample alternative required message.'\n            }\n        },\n        'check_more_messages': function(name,error){\n            return (this.more_messages[name] || [])[error] || null;\n        },\n        validation_messages: function(field,form,error_bin){\n            var messages = [];\n            for(var e in form[field].$error){\n                if(form[field].$error[e]){\n                    var special_message = this.check_more_messages(field,e);\n                    if(special_message){\n                        messages.push(special_message);\n                    }else if(this.message[e]){\n                        messages.push(this.message[e]);\n                    }else{\n                        messages.push(\"Error: \" + e)\n                    }\n                }\n            }\n            var deduped_messages = [];\n            angular.forEach(messages, function(el, i){\n                if(deduped_messages.indexOf(el) === -1) deduped_messages.push(el);\n            });\n            if(error_bin){\n                error_bin[field] = deduped_messages;\n            }\n        },\n        'form_validation': function(form,error_bin){\n            for(var field in form){\n                if(field.substr(0,1) != \"$\"){\n                    this.validation_messages(field,form,error_bin);\n                }\n            }\n        }\n    }\n});\n\napp.controller('VerifyEmailController', function ($scope, $stateParams, ebagisAPI) {\n    ebagisAPI.verify($stateParams[\"emailVerificationToken\"]).then(function(data) {\n        $scope.success = true;\n    }, function(data) {\n        $scope.failure = false;\n    });\n});\n",null],"sourceRoot":"/source/"}